<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas William Boughen">

<title>Annual Progress Review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="doc_files/libs/clipboard/clipboard.min.js"></script>
<script src="doc_files/libs/quarto-html/quarto.js"></script>
<script src="doc_files/libs/quarto-html/popper.min.js"></script>
<script src="doc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="doc_files/libs/quarto-html/anchor.min.js"></script>
<link href="doc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="doc_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="doc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="doc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="doc_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#extreme-value-theory" id="toc-extreme-value-theory" class="nav-link active" data-scroll-target="#extreme-value-theory"><span class="header-section-number">1</span> Extreme Value Theory</a>
  <ul class="collapse">
  <li><a href="#standard-theory" id="toc-standard-theory" class="nav-link" data-scroll-target="#standard-theory">Standard Theory</a></li>
  <li><a href="#discrete-extremes" id="toc-discrete-extremes" class="nav-link" data-scroll-target="#discrete-extremes">Discrete Extremes</a></li>
  </ul></li>
  <li><a href="#networks" id="toc-networks" class="nav-link" data-scroll-target="#networks"><span class="header-section-number">2</span> Networks</a>
  <ul class="collapse">
  <li><a href="#mathematical-definition" id="toc-mathematical-definition" class="nav-link" data-scroll-target="#mathematical-definition">Mathematical Definition</a></li>
  <li><a href="#analysis-of-real-world-networks" id="toc-analysis-of-real-world-networks" class="nav-link" data-scroll-target="#analysis-of-real-world-networks">Analysis of Real World Networks</a>
  <ul class="collapse">
  <li><a href="#power-law-igp-mixture-model-pl-igp" id="toc-power-law-igp-mixture-model-pl-igp" class="nav-link" data-scroll-target="#power-law-igp-mixture-model-pl-igp">Power Law IGP Mixture Model (PL-IGP)</a></li>
  </ul></li>
  <li><a href="#network-generative-models" id="toc-network-generative-models" class="nav-link" data-scroll-target="#network-generative-models">Network Generative Models</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="doc.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="doc.odt"><i class="bi bi-file"></i>OpenOffice</a></li></ul></div></nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Annual Progress Review</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Thomas William Boughen </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Newcastle University
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<section id="extreme-value-theory" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Extreme Value Theory</h1>
<p>Extreme value theory is a field focused on studying properties at the tail ends of distributions where real world data may be scarce and hard to make inferences from. A lot of the standard theory assumes continuous distributions and that is what will be introduced first before looking at what has been done relating to discrete distributions.</p>
<section id="standard-theory" class="level2">
<h2 class="anchored" data-anchor-id="standard-theory">Standard Theory</h2>
<p>One approach for modelling the extreme values is to look at modelling the block maxima of independent and identically distributed random variables <span class="math inline">\(X_1,X_2 \ldots\)</span> that all have a common cumulative distribution function (CDF) <span class="math inline">\(F\)</span>. The block maxima <span class="math inline">\(M_n\)</span> being defined as <span class="math inline">\(M_n = \max\{X_1,\ldots,X_n\}\)</span> has its own CDF defined by:</p>
<p><span class="math display">\[
\Pr(M_n\le x) = F_n(x)
\]</span></p>
<p><span class="math inline">\(F\)</span> is in the domain of attraction of an extreme value CDF <span class="math inline">\(G\)</span>, if and only if the normalised version of <span class="math inline">\(M_n\)</span>’s CDF converges to a non degenerate <span class="math inline">\(G\)</span>, that is, there exists some sequence of <span class="math inline">\(a_n&gt;0\)</span> and <span class="math inline">\(b_n \in \mathbb R\)</span> such that:</p>
<p><span class="math display">\[
\Pr\left(\frac{M_n-b_n}{a_n}\le x\right) = F^n(a_nx+b_n) \rightarrow G(x),\qquad \text{as }n\rightarrow\infty
\]</span></p>
<p>If this holds, then <span class="math inline">\(F\)</span> is in the domain of attraction of <span class="math inline">\(G\)</span> which we will write as <span class="math inline">\(F\in\mathcal D(G)\)</span>. The extreme value theorem states that is limit CDF <span class="math inline">\(G\)</span> can be catagorised into one of three types:</p>
<ul>
<li><p>Gumbel: <span class="math inline">\(\Lambda(x) = \exp\{-\exp(-x)\},\quad x\in \mathbb R\)</span></p></li>
<li><p>Fréchet: <span class="math inline">\(\Phi_a(x) = \exp\{-x^{-\alpha}\},\quad x\ge 0,\alpha&gt;0\)</span></p></li>
<li><p>Weibull: <span class="math inline">\(\Psi_\alpha(x) = \exp\{-x^{-a}\},\quad x&lt;0,\alpha&gt;0\)</span></p></li>
</ul>
<div id="def-gev" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1 (Generalised Extreme Value Distribution) </strong></span>These three types of distribution can be combined into one single distribution called the Generalised Extreme Value (<strong>GEV</strong>) Distribution which has CDF:</p>
<p><span class="math display">\[
G(x) = \exp\left\{-\left(1+\frac{\xi(x-\mu)}{\sigma}\right)^{-1/\xi}\right\}
\]</span></p>
<p>denoted <span class="math inline">\(\text{GEV}(\mu, \sigma, \xi)\)</span> for some <span class="math inline">\(\mu\in\mathbb R,\sigma&gt;0, \xi \in \mathbb R\)</span> and has support on <span class="math inline">\(\{x\in \mathbb R:1+\xi(x-\mu)/\sigma &gt; 0\}\)</span> with each of the three types being obtained from changing the values of each of the parameters with <span class="math inline">\(\xi=0\)</span> taken as the limit:</p>
<ul>
<li><p>Gumbel: <span class="math inline">\(\text{GEV}(\mu, \sigma,0)\)</span></p></li>
<li><p>Fréchet: <span class="math inline">\(\text{GEV}(1, 1,1/\alpha)\)</span></p></li>
<li><p>Weibull: <span class="math inline">\(\text{GEV}(-1, -1,-1/\alpha)\)</span></p></li>
</ul>
<p>The most important parameter here is <span class="math inline">\(\xi\)</span> which will be referred to as the shape parameter as it controls the tail behaviour of the distribution allowing it to occupy the three domains of attraction.</p>
</div>
<div id="def-heavy" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2 (Heavy Tails) </strong></span>There are a few definitions that can be used to define a distribution that has heavy tails, one that will not be used here is that the tails of the distribution function are heavier than an exponential. Here, a distribution with CDF <span class="math inline">\(F\)</span> will be said to have heavy tails if it is in the Fréchet domain of attraction with tail index <span class="math inline">\(\alpha\)</span>, or it is in the Gumbel domain of attraction.</p>
</div>
<div id="def-gp" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3 (Generalised Pareto Distribution) </strong></span>A related distribution called the Generalised Pareto (<strong>GP</strong>) Distribution is also often used to model the probability distribution of threshold excesses, it has the CDF: <span class="math display">\[
H(x) = 1-\left(1+\frac{\xi x}{\sigma}\right)^{-1/\xi}
\]</span> denoted <span class="math inline">\(\text{GP}(\sigma,\xi)\)</span> for some <span class="math inline">\(\sigma&gt;0, \xi\in \mathbb R\)</span> it has support on either <span class="math inline">\((0,\infty)\)</span> when <span class="math inline">\(\xi \ge 0\)</span> or <span class="math inline">\((0,-\sigma/\xi)\)</span> when <span class="math inline">\(\xi&lt;0\)</span>.</p>
</div>
<p>This distribution of often used to model the conditional probability of iid random variables exceeding some cut-off <span class="math inline">\(u\)</span>. However, like most of the theory above, it requires iid discrete random variable; in the case of networks and modelling the degrees of their vertices the focus is on discrete data so tools to aid in modelling discrete data are required.</p>
</section>
<section id="discrete-extremes" class="level2">
<h2 class="anchored" data-anchor-id="discrete-extremes">Discrete Extremes</h2>
<p>Since the focus of this report is discrete data, theory on discrete extremes will need to be examined starting with a discrete alternative to the GP distribution.</p>
<div id="def-igp" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 4 (Integrated Generalised Pareto Distribution) </strong></span>Roughly following <span class="citation" data-cites="Rohrbeck_2018">Rohrbeck et al. (<a href="#ref-Rohrbeck_2018" role="doc-biblioref">2018</a>)</span>, the integrated generalised pareto (<strong>IGP</strong>) distribution can be defined by considering modelling the random variable <span class="math inline">\(Y = \lceil X\rceil\)</span> for some continuous random variable <span class="math inline">\(X\)</span> with support on the positive real line such that <span class="math inline">\(X|X&gt;u \sim \text{GPD}(\sigma_0+\xi u, \xi)\)</span> for <span class="math inline">\(\xi\in\mathbb R,u\in\mathbb R^+\)</span>. The probability mass function (PMF) of the IGP distribution can then be defined as:</p>
<p>For values <span class="math inline">\(y = \lfloor u \rfloor, \lfloor u \rfloor+1, \ldots\)</span> and <span class="math inline">\(\xi \in \mathbb R\)</span> and <span class="math inline">\(u,\sigma_0 \in\mathbb R^+\)</span>:</p>
<span class="math display">\[\begin{align*}
\Pr(Y=y | Y&gt;u) &amp;= \Pr(X&lt;y|X&gt;\lfloor u\rfloor) - \Pr(X&lt;y-1|X&gt;\lfloor u\rfloor) \\
&amp;=\left(1+\frac{\xi(y-1-\lfloor u\rfloor)}{\sigma_0 + \xi \lfloor u \rfloor}\right)_+^{-1/\xi} - \left(1+\frac{\xi(y-\lfloor u\rfloor)}{\sigma_0 + \xi \lfloor u \rfloor}\right)_+^{-1/\xi}
\end{align*}\]</span>
<p>By modelling the ceiling of a continuous random variable, it is also suggested that one could instead model the floor of a continuous random variable instead. Indeed, that is what will be done from here on out. Consider modelling the random variable <span class="math inline">\(Y=\lfloor X\rfloor\)</span>, the PMF of the IGP then becomes:</p>
<p>For values <span class="math inline">\(y=\lceil u \rceil,\lceil u \rceil +1,\ldots\)</span> and <span class="math inline">\(\xi \in \mathbb R\)</span> and <span class="math inline">\(u,\sigma_0 \in\mathbb R^+\)</span>: par<span class="math display">\[
\Pr(Y=y | Y&gt;u) = \left(1+\frac{\xi(y-\lceil u\rceil)}{\sigma_0 + \xi \lceil u \rceil}\right)_+^{-1/\xi} - \left(1+\frac{\xi(y+1-\lceil u\rceil)}{\sigma_0 + \xi \lceil u \rceil}\right)_+^{-1/\xi}
\]</span></p>
</div>
<p>If this is to be used as a discrete alternative to the GP distribution, it needs to be verified that the parameter <span class="math inline">\(\xi\)</span> affects the tail behaviour in the same way. The results from <span class="citation" data-cites="shimura12">Shimura (<a href="#ref-shimura12" role="doc-biblioref">2012</a>)</span> can be used to show that this distribution will indeed belong to the same domain of attraction as the GP distribution for any given value of <span class="math inline">\(\xi\)</span>. <span class="citation" data-cites="shimura12">Shimura (<a href="#ref-shimura12" role="doc-biblioref">2012</a>)</span> also introduces an important quantity that will be useful in finding what domain of attraction a discrete distribution belongs to, namely:</p>
<p><span class="math display">\[
\Omega(F,n) = \left(\log\frac{\bar F(n+1)}{\bar F(n+2)}\right)^{-1} -\left(\log\frac{\bar F(n)}{\bar F(n+1)}\right)^{-1}
\]</span></p>
<p>where <span class="math inline">\(\bar F\)</span> is the survival function of a discrete random variable.</p>
<p>While a lot of distributions may be just be heavy tails, it will be useful to define what is means for a distribution to have super heavy tails. There are several definitions being used but here the one from [SUPER HEAVY ref] will be used.</p>
<div id="def-superheavy" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5 (Super Heavy Tails) </strong></span>A distribution with <span class="math inline">\(f,F,\bar F\)</span> as its pdf, cdf, and survival respectively is said to have super heavy tails if the survival function <span class="math inline">\(\bar F\)</span> is slowly varying. That is: <span class="math display">\[
\lim_{x\rightarrow\infty}\frac{\bar F(cx)}{\bar F(x)} = 1, \qquad\forall c \in \mathbb{R^+}
\]</span> It should be noted that this condition is sufficient but not necessary and does not capture all distributions with super heavy tails.</p>
</div>
</section>
</section>
<section id="networks" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Networks</h1>
<p>In the previous section an overview of extreme value theory was given, in this section context will be given as to what distributions are in the scope of this research and what they arise from.</p>
<section id="mathematical-definition" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-definition">Mathematical Definition</h2>
<p>The networks being analysed will be treated as mathematical graphs that consist of two kinds of objects, vertices that usually represent the individual components in a complex system, and edges that represent the relationships between these components. The focus, for now, will be on undirected networks and therefore undirected graphs.</p>
<div id="def-graph" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 6 (Undirected Graph) </strong></span>An undirected graph <span class="math inline">\(G\)</span> consists of a set of vertices <span class="math inline">\(V\)</span> and a set of edges between these vertices say <span class="math inline">\(E\)</span>, this will be denoted as <span class="math inline">\(G = (V,E)\)</span> where <span class="math inline">\(V\)</span> is usually a subset of <span class="math inline">\(\mathbb N\)</span> and <span class="math inline">\(E\)</span> is a subset of the set of unordered pairs of <span class="math inline">\(V\)</span>.</p>
</div>
<div id="def-deg" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 7 (Degree) </strong></span>A vertex <span class="math inline">\(i\)</span> has degree <span class="math inline">\(k_i\)</span>, where <span class="math inline">\(k_i\)</span> is the number of appearances of <span class="math inline">\(i\)</span> in the set <span class="math inline">\(E\)</span>. That is, the degree of a vertx is the number of edges that connect to it.</p>
</div>
</section>
<section id="analysis-of-real-world-networks" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-real-world-networks">Analysis of Real World Networks</h2>
<p>Before looking at what has and could be used to model the growth of real networks, it will be useful to analyse some examples. The property of focus here will be the degree distribution of real world networks, more specifically the tail behaviour. <a href="#fig-survs">Figure&nbsp;1</a> shows the survival function of the degree distribution (on a log-log plot) for four examples of real world networks that represent: game results between top tennis players, facebook friends of Harvard students and alumni, interactions between proteins in cells, and the dependencies of R packages.</p>
<div class="cell" data-fig.hold="true" data-fig.asp="0.2">
<div class="cell-output-display">
<div id="fig-survs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="doc_files/figure-html/fig-survs-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Survival function of the degrees.</figcaption>
</figure>
</div>
</div>
</div>
<p>The shapes of the curves in <a href="#fig-survs">Figure&nbsp;1</a> are all fairly different but, they all seem to start with what looks like one power law and then begins to deviate after a certain point indicating the while the bulk of the data follows the one power law the right tail does not necessarily exhibit the same behaviour. Seeing this and with the aim of investigating the tail-heaviness of networks degree distributions, fitting a model that uses a power law for the bulk of the data and the IGP distribution (<a href="#def-igp">Definition&nbsp;4</a>) for the right tail above a certain threshold should allow for estimation of the tail-index.</p>
<section id="power-law-igp-mixture-model-pl-igp" class="level3">
<h3 class="anchored" data-anchor-id="power-law-igp-mixture-model-pl-igp">Power Law IGP Mixture Model (PL-IGP)</h3>
<p>A traditional way of modelling continuous extreme values often involves using the GP distribution (<a href="#def-gp">Definition&nbsp;3</a>) to model the conditional distribution of the largest values however here the data is discrete and so instead the IGP will be used as an alternative. For the bulk of the data a truncated power law distribution will be used which is defined in <a href="#def-tpl">Definition&nbsp;8</a> below, and for the right tail the IGP will be used.</p>
<div id="def-tpl" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8 (Truncated Power Law) </strong></span>The truncated power law distribution has two parameters <span class="math inline">\(\alpha \in \mathbb R\)</span>,<span class="math inline">\(v \in \mathbb Z^+\)</span> and has support of <span class="math inline">\((1,v)\)</span>. The pdf of this distribution is: <span class="math display">\[
f(x) = \begin{cases}
\frac{x^{-(\alpha+1)}}{\sum_{i=1}^v i^{-(\alpha+1)}}&amp;,x=1,2,\ldots,v\\
0&amp;,\text{otherwise}
\end{cases}
\]</span></p>
</div>
</section>
</section>
<section id="network-generative-models" class="level2">
<h2 class="anchored" data-anchor-id="network-generative-models">Network Generative Models</h2>
<p>The way in which vertices and edges are added and removed from networks over time is of great interest as it can lead to inferences about the underlying mechanics of a complex system and allow for theorising what may happen to the network in the future. To that end, finding a model that is both simple enough and leads to properties that match real world networks is of utmost importance. Next, the degree distribution of various network models are analysed starting fairly simple and gradualling getting more complex.</p>
<div id="def-uniform" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9 (Uniform attachment model) </strong></span>Consider an initial graph <span class="math inline">\(G_0\)</span> with vertex set <span class="math inline">\(V_0=\{1,2,\ldots,m_0\}\)</span> and edge set <span class="math inline">\(E_0=\emptyset\)</span>. Starting at <span class="math inline">\(t=1\)</span> repeat the steps below:</p>
<ol type="1">
<li>Add a vertex to the network, <span class="math inline">\(V_t=V_{t-1}\cup\{m_0+t\}\)</span></li>
<li>Add <span class="math inline">\(m\le m_0\)</span> edges to the network connecting the new vertex to those in already in the network. With the existing vertices to be chosen uniformly at random from <span class="math inline">\(V_{t-1}\)</span> with replacement.</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="references" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Rohrbeck_2018" class="csl-entry" role="listitem">
Rohrbeck, Christian, Emma F. Eastoe, Arnoldo Frigessi, and Jonathan A. Tawn. 2018. <span>“<span class="nocase">Extreme value modelling of water-related insurance claims</span>.”</span> <em>The Annals of Applied Statistics</em> 12 (1): 246–82. <a href="https://doi.org/10.1214/17-AOAS1081">https://doi.org/10.1214/17-AOAS1081</a>.
</div>
<div id="ref-shimura12" class="csl-entry" role="listitem">
Shimura, Takaaki. 2012. <span>“Discretization of Distributions in the Maximum Domain of Attraction.”</span> <em>Extremes</em> 15 (September): 1–19. <a href="https://doi.org/10.1007/s10687-011-0137-7">https://doi.org/10.1007/s10687-011-0137-7</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>